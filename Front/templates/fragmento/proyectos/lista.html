{% extends 'index.html'%}

{% block content %}

{% with messages = get_flashed_messages(with_categories=True) %}
  {% if messages %}
    {% for message in messages %}
      {% if message[0] == 'info' %}
        <div class="alert alert-primary alert-dismissible fade show" role="alert">
          <h4 class="alert-heading">Â¡Ã‰xito!</h4>
          <p>{{ message[1]}}</p>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
        </div>
      {% else %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <h4 class="alert-heading">Â¡Error!</h4>
          <p>{{ message[1]}}</p>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
        </div>
      {% endif %}
    {% endfor %}
  {% endif %}
{% endwith %}


<div class="pagetitle">
  <h1>Lista de Proyectos</h1>
</div>
<section class="section">
  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-body"><br>
          <div>
            <div class="form-inline">
              <a href="/proyect/register" class="btn btn-success rounded-pill">Crear</a>

              <select class="form-select" style="width: 150px;" id="atributo">
                <option value="nombre">Nombre</option>
                <option value="fechaInicio">Fecha de Inicio</option>
                <option value="fechaFin">Fecha de FinalizaciÃ³n</option>
              </select>
                      
              <input class="form-control" style="width: 150px;" id="texto" type="text">
              <i class="bx bx-search-alt" id="btn" title="Buscar"></i>
              
              <select class="form-select" style="width: 150px;" name="sortMethod" id="sortMethod">
                <option value="0">Quick Sort</option> 
                <option value="1">Merge Sort</option>
                <option value="2">Shell Sort</option>
              </select>

              <a hidden href="#" id="sortA"></a> 
            </div>
              <table class="table">
                <thead>
                  <tr class="table-warning">
                    <th scope="col">Nro</th>
                    <th scope="col">
                      Nombre del Proyecto
                      <span onclick="sortFunct('nombre','1')">ðŸ¡¡</span> 
                      <span onclick="sortFunct('nombre','0')">ðŸ¡«</span>
                    </th>
                    <th scope="col">
                      Fecha<br>de Inicio
                      <span onclick="sortFunct('fechaInicio','1')">ðŸ¡¡</span> 
                      <span onclick="sortFunct('fechaInicio','0')">ðŸ¡«</span>
                    </th>
                    <th scope="col">
                      Fecha de<br>FinalizaciÃ³n
                      <span onclick="sortFunct('fechaFin','1')">ðŸ¡¡</span> 
                      <span onclick="sortFunct('fechaFin','0')">ðŸ¡«</span>
                    </th>
                    <th scope="col">
                      Costo
                      <span onclick="sortFunct('costo','1')">ðŸ¡¡</span>
                      <span onclick="sortFunct('costo','0')">ðŸ¡«</span>
                    </th>
                    <th scope="col">
                      Cantidad de<br>Electricidad
                      <span onclick="sortFunct('cantidadElectricidad','1')">ðŸ¡¡</span>
                      <span onclick="sortFunct('cantidadElectricidad','0')">ðŸ¡«</span>
                    </th>
                    <th scope="col">
                      Monto Total<br>de InversiÃ³n
                      <span onclick="sortFunct('montoTotalInversion','1')">ðŸ¡¡</span>
                      <span onclick="sortFunct('montoTotalInversion','0')">ðŸ¡«</span>
                    </th> 
                    <th scope="col">Provincia
                      <span onclick="sortFunct('provincia','1')">ðŸ¡¡</span> 
                      <span onclick="sortFunct('provincia','0')">ðŸ¡«</span>
                    </th>
                    <th scope="col">Acciones</th>
                  </tr>
                </thead>

                <tbody>
                  {% for proyecto in proyectos %}
                    <tr>
                      <td>{{ proyecto.numero}}</td>
                      <td>{{ proyecto.nombre }}</td>
                      <td>{{ proyecto.fechaInicio }}</td>
                      <td>{{ proyecto.fechaFin }}</td>
                      <td>{{ proyecto.costo }}</td>
                      <td>{{ proyecto.cantElectricidad }}</td>
                      <td>{{ proyecto.montoTotalInversion }}</td>
                      <td>{{ proyecto.provincia }}</td>
                      <td>
                        <a href="/proyect/edit/{{ proyecto.id }}" class="btn btn-info rounded-pill" ">Modificar</a>
                        <a href=" /proyect/delete/{{ proyecto.id }}" class="btn btn-danger rounded-pill" ">Eliminar</a>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<a id="search" href="proyect/list"></a>
<script>
  const sortUrl = '/proyect/sort'
  function sortFunct(attr,ord) {
    const newHref = `${sortUrl}/${attr}/${ord}/${$('#sortMethod').val()}`;
    $('#sortA').attr('href',newHref) 
    console.log($('#sortA').attr('href'))
    $('#sortA')[0].click()
  }
  $(document).ready(function () {
    $("#btn").click(function () {
      search();
    });
    function search() {
      var texto = $("#texto").val();
      var atributo = $("#atributo").val();
      if (texto == "") {
        alert("Ingrese un valor");
        return;
      } else {
        $("#search").attr("href", "/proyect/search/" + atributo + "/" + texto);
        $("#search")[0].click();
      }
    }
  });
</script>
{% endblock %}